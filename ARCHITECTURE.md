# äººå£æ¨¡æ‹Ÿå™¨æ¸¸æˆ - æ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
2. [æ•°æ®æµå‘](#æ•°æ®æµå‘)
3. [è®¡ç®—å…¬å¼æ±‡æ€»](#è®¡ç®—å…¬å¼æ±‡æ€»)
4. [ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’](#ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’)

---

## 1. ç³»ç»Ÿæ¶æ„

### 1.1 æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯æ¡†æ¶                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React 18 + TypeScript + Vite                   â”‚
â”‚  Zustand (çŠ¶æ€ç®¡ç†)                             â”‚
â”‚  HTML5 Canvas (å¯è§†åŒ–)                          â”‚
â”‚  Recharts (å›¾è¡¨)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç›®å½•ç»“æ„

```
socio-core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/           # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ canvas/          # Canvaså¯è§†åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ PopulationCanvas.tsx           # å±•ç¤ºç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ PopulationCanvasContainer.tsx  # å®¹å™¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ policies/        # æ”¿ç­–é¢æ¿
â”‚   â”‚   â”œâ”€â”€ statistics/      # ç»Ÿè®¡é¢æ¿
â”‚   â”‚   â”œâ”€â”€ events/          # äº‹ä»¶é€šçŸ¥
â”‚   â”‚   â”œâ”€â”€ layout/          # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â””â”€â”€ gameending/      # æ¸¸æˆç»“å±€
â”‚   â”‚
â”‚   â”œâ”€â”€ game/                # æ¸¸æˆå¼•æ“
â”‚   â”‚   â””â”€â”€ engine/
â”‚   â”‚       â”œâ”€â”€ GameEngine.ts          # æ¸¸æˆå¼•æ“ â­
â”‚   â”‚       â”œâ”€â”€ TimeSystem.ts          # æ—¶é—´ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ EventSystem.ts         # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”‚       â””â”€â”€ GameEndingSystem.ts    # ç»“å±€ç³»ç»Ÿ
â”‚   â”‚
â”‚   â”œâ”€â”€ store/               # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ gameStore.ts                 # æ¸¸æˆä¸»çŠ¶æ€ â­
â”‚   â”‚   â”œâ”€â”€ uiStore.ts                   # UIçŠ¶æ€
â”‚   â”‚   â””â”€â”€ types.ts                     # ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ecs/                 # ECSæ¶æ„ï¼ˆå·²å®ç°ï¼Œå¾…é›†æˆï¼‰
â”‚   â”‚   â”œâ”€â”€ core/             # ECSæ ¸å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ Entity.ts      # å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ World.ts       # ä¸–ç•Œç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Query.ts       # æŸ¥è¯¢ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ System.ts      # ç³»ç»ŸåŸºç±»
â”‚   â”‚   â”‚   â””â”€â”€ EventBus.ts    # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”œâ”€â”€ components/       # ç»„ä»¶å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ PersonComponents.ts
â”‚   â”‚   â”œâ”€â”€ systems/          # ç³»ç»Ÿå®ç°ï¼ˆ17ä¸ªç³»ç»Ÿï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ PopulationSystem.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceSystem.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ PolicySystem.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ stores/           # ECSä¸“ç”¨Store
â”‚   â”‚   â”‚   â”œâ”€â”€ PersonStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceStore.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ selectors/        # é€‰æ‹©å™¨å±‚
â”‚   â”‚       â”œâ”€â”€ personSelectors.ts
â”‚   â”‚       â”œâ”€â”€ resourceSelectors.ts
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ constants/           # æ¸¸æˆå¸¸é‡
â”‚   â”‚   â”œâ”€â”€ game.ts                       # æ¸¸æˆå¸¸é‡ â­
â”‚   â”‚   â”œâ”€â”€ policies.ts                   # æ”¿ç­–å®šä¹‰
â”‚   â”‚   â””â”€â”€ achievements.ts               # æˆå°±å®šä¹‰
â”‚   â”‚
â”‚   â””â”€â”€ App.tsx             # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ public/                   # é™æ€èµ„æº
â”œâ”€â”€ index.html               # HTMLå…¥å£
â”œâ”€â”€ vite.config.ts           # Viteé…ç½®
â”œâ”€â”€ tsconfig.json            # TypeScripté…ç½®
â””â”€â”€ package.json             # ä¾èµ–é…ç½®
```

### 1.3 æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### 1.3.1 GameEngineï¼ˆæ¸¸æˆå¼•æ“ï¼‰

**èŒè´£**ï¼šæ¸¸æˆä¸»å¾ªç¯åè°ƒå™¨

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```typescript
class GameEngine {
  // æ¸¸æˆå¾ªç¯æ§åˆ¶
  start(): void;                      // å¯åŠ¨å¼•æ“
  pause(): void;                      // æš‚åœå¼•æ“
  setGameSpeed(speed): void;          // è®¾ç½®æ¸¸æˆé€Ÿåº¦
  destroy(): void;                    // é”€æ¯å¼•æ“

  // æ¯æœˆTickå¤„ç†
  private onTick(): void;             // ä¸»å¾ªç¯tick
  private processPopulation(): void;  // äººå£å¤„ç†
  private processResources(): void;   // èµ„æºå¤„ç†
  private updateUIState(): void;      // UIæ›´æ–°
}
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
requestAnimationFrame
       â†“
loop() â†’ TimeSystem.update()
       â†“
æ¯1000ms â†’ onTick()
       â†“
1. æ£€æŸ¥éšæœºäº‹ä»¶
2. æ¨è¿›æ—¶é—´ï¼ˆ+1æœˆï¼‰
3. å¤„ç†äººå£ï¼ˆç”Ÿè‚²ã€æ­»äº¡ã€å¹´é¾„å¢é•¿ï¼‰
4. å¤„ç†èµ„æºï¼ˆç”Ÿäº§ã€æ¶ˆè€—ã€å­£èŠ‚ä¿®æ­£ï¼‰
5. æ›´æ–°UI
6. æ£€æŸ¥æ¸¸æˆç»“æŸæ¡ä»¶
```

#### 1.3.2 gameStoreï¼ˆæ¸¸æˆçŠ¶æ€ï¼‰

**çŠ¶æ€ç»“æ„**ï¼š
```typescript
interface GameState {
  // æ—¶é—´
  currentYear: number;
  currentMonth: number;
  totalMonths: number;
  gameSpeed: GameSpeed;

  // äººå£
  people: Map<string, Person>;
  populationCount: number;

  // èµ„æº
  resources: Resources;

  // æ”¿ç­–
  policies: Policy[];
  activePolicies: string[];

  // ç»Ÿè®¡
  statistics: GameStatistics;

  // æˆå°±
  achievements: Achievement[];
  unlockedAchievements: string[];

  // äº‹ä»¶
  eventHistory: string[];

  // æ¸¸æˆçŠ¶æ€
  isGameOver: boolean;
  gameStarted: boolean;
}
```

**æ ¸å¿ƒæ“ä½œ**ï¼š
```typescript
interface GameActions {
  // æ¸¸æˆæ§åˆ¶
  startGame(): void;
  resetGame(): void;

  // æ—¶é—´ç®¡ç†
  advanceTime(months: number): void;

  // äººå£ç®¡ç†
  addPerson(person: Person): void;
  updatePerson(id: string, updates: Partial<Person>): void;

  // èµ„æºç®¡ç†
  updateResources(updates: Partial<Resources>): void;

  // æ”¿ç­–ç®¡ç†
  activatePolicy(policyId: string): void;
  deactivatePolicy(policyId: string): void;

  // ç»Ÿè®¡ç®¡ç†
  recordBirth(): void;
  recordDeath(): void;
  updateStatistics(): void;

  // äº‹ä»¶ç®¡ç†
  addEventToHistory(event: string): void;
}
```

#### 1.3.3 ECSæ¶æ„ï¼ˆå·²å®ç°ï¼Œå¾…é›†æˆï¼‰

**ECSæ ¸å¿ƒæ¦‚å¿µ**ï¼š

```typescript
// Entityï¼ˆå®ä½“ï¼‰- å”¯ä¸€ID
class Entity {
  readonly id: EntityID;
  readonly components: Set<ComponentType>;
}

// Componentï¼ˆç»„ä»¶ï¼‰- çº¯æ•°æ®
interface IdentityComponent {
  entityId: EntityID;
  gender: 'male' | 'female';
  birthMonth: number;
}

interface BiologicalComponent {
  health: number;
  fertility: number;
  isAlive: boolean;
}

// Systemï¼ˆç³»ç»Ÿï¼‰- çº¯é€»è¾‘
class PopulationSystem extends System {
  update(deltaTime: number): void {
    // å¤„ç†ç”Ÿè‚²ã€æ­»äº¡ã€å©šå§»é€»è¾‘
  }
}

// Worldï¼ˆä¸–ç•Œï¼‰- åè°ƒå™¨
class World {
  createEntity(): Entity;
  addComponent<T>(entityId, type, component: T): void;
  query(query: Query): Entity[];
  update(deltaTime: number): void;
}
```

**ECS Systemsï¼ˆ17ä¸ªç³»ç»Ÿï¼‰**ï¼š

| ç³»ç»Ÿ | èŒè´£ | ä¼˜å…ˆçº§ |
|------|------|--------|
| PopulationSystem | äººå£æ€»åè°ƒ | 100 |
| AgingSystem | å¹´é¾„å¢é•¿ | 95 |
| DeathSystem | æ­»äº¡æ£€æŸ¥ | 95 |
| BirthSystem | ç”Ÿè‚²å¤„ç† | 90 |
| MarriageSystem | å©šå§»é…å¯¹ | 85 |
| ResourceSystem | èµ„æºæ€»åè°ƒ | 80 |
| FoodSystem | é£Ÿç‰©è®¡ç®— | 75 |
| MoneySystem | èµ„é‡‘è®¡ç®— | 75 |
| ShortageEffectSystem | çŸ­ç¼ºæ•ˆæœ | 70 |
| PolicySystem | æ”¿ç­–ç®¡ç† | 60 |
| PolicyEffectSystem | æ”¿ç­–æ•ˆæœ | 55 |
| StatisticsSystem | ç»Ÿè®¡æ”¶é›† | 50 |
| AchievementSystem | æˆå°±æ£€æŸ¥ | 40 |
| EventSystem | äº‹ä»¶è§¦å‘ | 30 |
| GameEndingSystem | ç»“å±€æ£€æŸ¥ | 20 |

**å½“å‰çŠ¶æ€**ï¼š
- âœ… ECSæ ¸å¿ƒæ¡†æ¶å®Œæ•´
- âœ… æ‰€æœ‰Systemå·²å®ç°
- â¸ï¸ æœªæ¿€æ´»ï¼ˆä½¿ç”¨gameStoreä½œä¸ºæ•°æ®æºï¼‰
- ğŸ”„ åç»­å¯è¿ç§»åˆ°å®Œå…¨ECSæ¶æ„

---

## 2. æ•°æ®æµå‘

### 2.1 æ•´ä½“æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æ“ä½œ    â”‚
â”‚ (ç‚¹å‡»æŒ‰é’®ç­‰)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reactç»„ä»¶   â”‚
â”‚ (Container)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gameStore   â”‚ â† å•ä¸€æ•°æ®æº
â”‚  (Zustand)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚
       â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GameEngine  â”‚  â”‚  UIç»„ä»¶      â”‚
â”‚  (é€»è¾‘å¤„ç†)  â”‚  â”‚  (å±•ç¤º)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gameStore   â”‚
â”‚  (æ›´æ–°çŠ¶æ€)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reacté‡æ¸²æŸ“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¸¸æˆå¾ªç¯æ•°æ®æµ

```
TimeSystem.update() æ¯1000msè§¦å‘ä¸€æ¬¡
        â”‚
        â†“
   onTick()
        â”‚
        â”œâ”€â”€â†’ 1. EventSystem.checkAndTriggerEvent()
        â”‚        â””â”€â”€â†’ gameStore.addEventToHistory()
        â”‚
        â”œâ”€â”€â†’ 2. gameStore.advanceTime(1)
        â”‚        â”œâ”€â”€â†’ currentMonth += 1
        â”‚        â””â”€â”€â†’ currentYearæ›´æ–°
        â”‚
        â”œâ”€â”€â†’ 3. processPopulation()
        â”‚        â”œâ”€â”€â†’ éå†æ‰€æœ‰å­˜æ´»äººå£
        â”‚        â”‚    â”œâ”€â”€â†’ å¹´é¾„+1/12
        â”‚        â”‚    â”œâ”€â”€â†’ å¥åº·è¡°å‡
        â”‚        â”‚    â”œâ”€â”€â†’ æ­»äº¡æ£€æŸ¥ â†’ handleDeath()
        â”‚        â”‚    â””â”€â”€â†’ ç”Ÿè‚²æ£€æŸ¥ â†’ handleBirth()
        â”‚        â”‚
        â”‚        â”œâ”€â”€â†’ handleDeath()
        â”‚        â”‚    â”œâ”€â”€â†’ updatePerson(isAlive: false)
        â”‚        â”‚    â”œâ”€â”€â†’ recordDeath()
        â”‚        â”‚    â””â”€â”€â†’ addEventToHistory()
        â”‚        â”‚
        â”‚        â””â”€â”€â†’ handleBirth()
        â”‚             â”œâ”€â”€â†’ addPerson(baby)
        â”‚             â”œâ”€â”€â†’ updatePerson(çˆ¶æ¯æ·»åŠ children)
        â”‚             â”œâ”€â”€â†’ recordBirth()
        â”‚             â””â”€â”€â†’ addEventToHistory()
        â”‚
        â”œâ”€â”€â†’ 4. processResources()
        â”‚        â”œâ”€â”€â†’ calculateFoodProduction()
        â”‚        â”œâ”€â”€â†’ calculateFoodConsumption()
        â”‚        â”œâ”€â”€â†’ calculateMoneyIncome()
        â”‚        â”œâ”€â”€â†’ calculateMoneyExpense()
        â”‚        â”œâ”€â”€â†’ getSeasonalModifier()
        â”‚        â”œâ”€â”€â†’ åº”ç”¨æ”¿ç­–bonus
        â”‚        â””â”€â”€â†’ updateResources()
        â”‚
        â”œâ”€â”€â†’ 5. updateUIState()
        â”‚
        â””â”€â”€â†’ 6. checkEndingConditions()
                 â””â”€â”€â†’ å¦‚æœè§¦å‘ç»“å±€ â†’ triggerGameEnding()
```

### 2.3 äººå£åˆå§‹åŒ–æµç¨‹

```
createInitialState()
        â”‚
        â†“
createInitialPopulation()
        â”‚
        â”œâ”€â”€â†’ åˆ›å»º50ä¸ªåˆå§‹äººå£
        â”‚     â”œâ”€â”€â†’ éšæœºæ€§åˆ«ï¼ˆç”·/å¥³ï¼‰
        â”‚     â”œâ”€â”€â†’ éšæœºå¹´é¾„ï¼ˆ18-50å²ï¼‰
        â”‚     â”œâ”€â”€â†’ åˆ†é…èŒä¸šï¼ˆ40%å†œæ°‘ï¼Œ35%å·¥äººï¼Œ15%ç§‘å­¦å®¶ï¼Œ10%å¤±ä¸šï¼‰
        â”‚     â””â”€â”€â†’ è®¾ç½®partner: undefined
        â”‚
        â””â”€â”€â†’ é…å¯¹å©šå§»
              â”œâ”€â”€â†’ ç­›é€‰é€‚é¾„ç”·å¥³ï¼ˆç”·20-50ï¼Œå¥³20-45ï¼‰
              â”œâ”€â”€â†’ åŒå‘é…å¯¹ï¼ˆè®¾ç½®partnerï¼‰
              â””â”€â”€â†’ éšæœºæ·»åŠ å­©å­
                    â””â”€â”€â†’ åˆå§‹æ€»äººå£: 50-60äºº
```

### 2.4 UIç»„ä»¶æ•°æ®æµ

**Containeræ¨¡å¼**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Containerç»„ä»¶                  â”‚
â”‚  (PopulationCanvasContainer)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  useGameStore()                 â”‚
â”‚  - people                       â”‚
â”‚  - populationCount              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®è½¬æ¢/Memo                  â”‚
â”‚  - filter(p => p.isAlive)       â”‚
â”‚  - è®¡ç®—å¹´é¾„ç»„                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentationalç»„ä»¶             â”‚
â”‚  (PopulationCanvas)             â”‚
â”‚  - çº¯UIæ¸²æŸ“                     â”‚
â”‚  - æ— Storeä¾èµ–                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. è®¡ç®—å…¬å¼æ±‡æ€»

### 3.1 äººå£ç³»ç»Ÿ

#### 3.1.1 å¹´é¾„å¢é•¿

```typescript
æ¯æœˆå¢é•¿ = 1/12 å² â‰ˆ 0.0833å²

newAge = oldAge + 1/12
```

#### 3.1.2 å¥åº·è¡°å‡

```typescript
if (age >= 80) {
  health -= 1;        // æ¯æœˆè¡°å‡1ç‚¹
} else if (age >= 60) {
  health -= 0.5;      // æ¯æœˆè¡°å‡0.5ç‚¹
}

health = Math.max(0, health)  // æœ€å°ä¸º0
```

#### 3.1.3 æ­»äº¡ç‡è®¡ç®—

```typescript
åŸºç¡€æ­»äº¡ç‡ = 0.001 (0.1%)

if (age < 40) {
  deathRate = 0.001;
} else if (age < 60) {
  deathRate = 0.005 + (100 - health) * 0.0001;
} else if (age < 80) {
  deathRate = 0.02 + (100 - health) * 0.0005;
} else {  // age >= 80
  deathRate = 0.05 + (100 - health) * 0.001;
}

// æ”¿ç­–ä¿®æ­£
finalDeathRate = deathRate * (1 + deathModifier)

if (Math.random() < finalDeathRate) {
  è§¦å‘æ­»äº¡
}
```

**æ­»äº¡ç‡å¯¹ç…§è¡¨**ï¼š

| å¹´é¾„ | å¥åº·å€¼ | æœˆæ­»äº¡ç‡ |
|------|--------|---------|
| <40å² | ä»»æ„   | 0.1%    |
| 40-60å² | 100   | 0.5%    |
| 40-60å² | 50    | 0.55%   |
| 40-60å² | 0     | 0.6%    |
| 60-80å² | 100   | 2%      |
| 60-80å² | 50    | 2.25%   |
| 60-80å² | 0     | 2.5%    |
| â‰¥80å² | 100   | 5%      |
| â‰¥80å² | 50    | 5.5%    |
| â‰¥80å² | 0     | 6%      |

#### 3.1.4 ç”Ÿè‚²ç‡è®¡ç®—

```typescript
åŸºç¡€ç”Ÿè‚²ç‡ = 0.05 (5%)

æ¡ä»¶æ£€æŸ¥ï¼š
- æ€§åˆ«: female
- å¹´é¾„: 18-45å²
- å·²å©š: partner != undefined
- å­å¥³æ•°: children.length < 5

birthChance = 0.05 * (1 + fertilityModifier)

if (Math.random() < birthChance) {
  è§¦å‘ç”Ÿè‚²
}
```

**é¢„æœŸç”Ÿè‚²æ•°**ï¼š

```
50äººå£ â†’ çº¦20-25å¯¹å¤«å¦‡ â†’ è‚²é¾„å¤«å¦‡çº¦15-20å¯¹
æ¯æœˆç”Ÿè‚²: 15-20å¯¹ Ã— 5% = 0.75-1ä¸ªæ–°ç”Ÿå„¿/æœˆ
æ¯å¹´ç”Ÿè‚²: çº¦9-12ä¸ªæ–°ç”Ÿå„¿
```

### 3.2 èµ„æºç³»ç»Ÿ

#### 3.2.1 é£Ÿç‰©ç”Ÿäº§

```typescript
// åŸºç¡€äº§å‡º
å†œæ°‘: baseProduction = 8
å·¥äºº: baseProduction = 3

// å¹´é¾„æ•ˆç‡
if (age >= 18 && age <= 30) ageEfficiency = 1.2
else if (age >= 51 && age <= 60) ageEfficiency = 0.8
else if (age < 18 || age > 60) ageEfficiency = 0.5
else ageEfficiency = 1.0  // 31-50å²

// å¥åº·æ•ˆç‡
if (health > 80) healthEfficiency = 1.2
else if (health < 60) healthEfficiency = 0.7
else if (health < 30) healthEfficiency = 0.4
else healthEfficiency = 1.0  // 60-80

// æŠ€èƒ½æ•ˆç‡
if (education >= 7) skillEfficiency = 1.3
else if (education >= 5) skillEfficiency = 1.1
else skillEfficiency = 1.0  // education < 5

// ä¸ªäººäº§å‡º
ä¸ªäººäº§å‡º = baseProduction Ã— ageEfficiency Ã— healthEfficiency Ã— skillEfficiency

// æ€»äº§å‡º
æ€»äº§å‡º = Î£(ä¸ªäººäº§å‡º)

// åœŸåœ°é™åˆ¶
æœ€å¤§äº§å‡º = äººå£æ•° Ã— 15
å®é™…äº§å‡º = min(æ€»äº§å‡º, æœ€å¤§äº§å‡º)

// å­£èŠ‚ä¿®æ­£
if (2æœˆ <= month <= 7æœˆ) {  // æ˜¥å¤
  å­£èŠ‚ç³»æ•° = 1.2
} else {  // ç§‹å†¬
  å­£èŠ‚ç³»æ•° = 0.8
}

è°ƒæ•´åäº§å‡º = floor(å®é™…äº§å‡º Ã— å­£èŠ‚ç³»æ•°)

// æ”¿ç­–åŠ æˆ
é£Ÿç‰©åŠ æˆ = Î£(floor(è°ƒæ•´åäº§å‡º Ã— policy.foodProduction))

// æœ€ç»ˆäº§å‡º
finalFoodProduction = è°ƒæ•´åäº§å‡º + é£Ÿç‰©åŠ æˆ
```

**è®¡ç®—ç¤ºä¾‹**ï¼š

```
å‡è®¾50äººï¼š
- å†œæ°‘20äººï¼ˆ40%ï¼‰
- å·¥äºº15äººï¼ˆ30%ï¼‰
- å…¶ä»–15äºº

å†œæ°‘äº§å‡ºè®¡ç®—ï¼š
- 18-30å²é’å¹´: 5äºº Ã— 8 Ã— 1.2(å¹´é¾„) Ã— 1.0(å¥åº·) Ã— 1.1(æŠ€èƒ½) = 52.8
- 31-50å²å£®å¹´: 10äºº Ã— 8 Ã— 1.0 Ã— 1.0 Ã— 1.1 = 88
- 51-60å²è€å¹´: 5äºº Ã— 8 Ã— 0.8 Ã— 1.0 Ã— 1.1 = 35.2
å†œæ°‘å°è®¡: 176

å·¥äººäº§å‡ºï¼š
15äºº Ã— 3 Ã— 1.0 = 45

æ€»äº§å‡º: 221
åœŸåœ°é™åˆ¶: 50 Ã— 15 = 750ï¼ˆæœªè§¦å‘ï¼‰

å­£èŠ‚è°ƒæ•´ï¼ˆæ˜¥å¤ï¼‰: 221 Ã— 1.2 = 265.2 â†’ 265
```

#### 3.2.2 é£Ÿç‰©æ¶ˆè€—

```typescript
åŸºç¡€æ¶ˆè€— = 1.0

// å¹´é¾„è°ƒæ•´
if (age < 7) baseConsumption = 0.5
else if (age < 13) baseConsumption = 0.7
else if (age < 19) baseConsumption = 0.9
else if (age >= 60) baseConsumption = 0.8

// ä½“åŠ›åŠ³åŠ¨é¢å¤–æ¶ˆè€—
if (occupation === 'farmer' || occupation === 'worker') {
  baseConsumption += 0.1
}

// æ€»æ¶ˆè€—
æ€»æ¶ˆè€— = Î£(ä¸ªäººæ¶ˆè€—)
finalFoodConsumption = ceil(æ€»æ¶ˆè€— Ã— 10) / 10
```

**æ¶ˆè€—å¯¹ç…§è¡¨**ï¼š

| å¹´é¾„ | æ¶ˆè€— | ä½“åŠ›åŠ³åŠ¨ | æ€»æ¶ˆè€— |
|------|------|---------|--------|
| 0-6å² | 0.5 | - | 0.5 |
| 7-12å² | 0.7 | - | 0.7 |
| 13-18å² | 0.9 | - | 0.9 |
| 19-59å² | 1.0 | å†œæ°‘/å·¥äºº | 1.1 |
| 19-59å² | 1.0 | å…¶ä»– | 1.0 |
| 60+å² | 0.8 | - | 0.8 |

**è®¡ç®—ç¤ºä¾‹**ï¼š

```
50äººæ¶ˆè€—ï¼š
- å„¿ç«¥(0-6å²): çº¦5äºº Ã— 0.5 = 2.5
- å°‘å¹´(7-12å²): çº¦5äºº Ã— 0.7 = 3.5
- é’å¹´(13-18å²): çº¦5äºº Ã— 0.9 = 4.5
- æˆäººå†œæ°‘/å·¥äºº: çº¦20äºº Ã— 1.1 = 22
- æˆäººå…¶ä»–: çº¦10äºº Ã— 1.0 = 10
- è€å¹´(60+å²): çº¦5äºº Ã— 0.8 = 4

æ€»æ¶ˆè€—: 46.5 â†’ 46.5
```

#### 3.2.3 èµ„é‡‘æ”¶å…¥

```typescript
æ”¶å…¥ = 0

// ç¨æ”¶
if (19 <= age <= 60) {
  æ”¶å…¥ += 5  // æˆå¹´äººç¨æ”¶
} else if (age >= 60) {
  æ”¶å…¥ += 2  // è€å¹´äººç¨æ”¶
}

// èŒä¸šäº§å‡º
switch (occupation) {
  case 'worker':
    æ”¶å…¥ += 15
    break
  case 'scientist':
    æ”¶å…¥ += 20
    break
  case 'farmer':
    æ”¶å…¥ += 3  // å†œäº§å“é”€å”®
    break
}

// æ€»æ”¶å…¥
totalMoneyIncome = Î£(ä¸ªäººæ”¶å…¥)
```

**è®¡ç®—ç¤ºä¾‹**ï¼š

```
50äººæ”¶å…¥ï¼š
- å·¥äºº(15äºº): 15 Ã— (5ç¨æ”¶ + 15èŒä¸š) = 300
- ç§‘å­¦å®¶(5äºº): 5 Ã— (5ç¨æ”¶ + 20èŒä¸š) = 125
- å†œæ°‘(20äºº): 20 Ã— (5ç¨æ”¶ + 3èŒä¸š) = 160
- å¤±ä¸šæˆå¹´äºº(5äºº): 5 Ã— 5ç¨æ”¶ = 25
- è€å¹´äºº(5äºº): 5 Ã— 2ç¨æ”¶ = 10

æ€»æ”¶å…¥: 620
```

#### 3.2.4 èµ„é‡‘æ”¯å‡º

```typescript
æ”¯å‡º = 5  // åŸºç¡€è®¾æ–½ç»´æŠ¤

// æˆå¹´äººåŸºç¡€æ”¯å‡º
if (age >= 19) {
  æ”¯å‡º += 1
}

// å¤±ä¸šæ•‘æµé‡‘
if (occupation === 'unemployed') {
  æ”¯å‡º += 2
}

// æ€»æ”¯å‡º
totalMoneyExpense = Î£(ä¸ªäººæ”¯å‡º) + åŸºç¡€è®¾æ–½ç»´æŠ¤
```

**è®¡ç®—ç¤ºä¾‹**ï¼š

```
50äººæ”¯å‡ºï¼š
- åŸºç¡€è®¾æ–½: 5
- æˆå¹´äºº(45äºº): 45 Ã— 1 = 45
- å¤±ä¸šæ•‘æµ(5äºº): 5 Ã— 2 = 10

æ€»æ”¯å‡º: 60
```

#### 3.2.5 å­£èŠ‚ä¿®æ­£

```typescript
function getSeasonalModifier(month: number): { food: number } {
  // æ˜¥å­£(2-7æœˆ)äº§é‡+20%ï¼Œç§‹å­£(8-1æœˆ)äº§é‡-20%
  if (month >= 2 && month <= 7) {
    return { food: 1.2 }  // æ˜¥å¤
  } else {
    return { food: 0.8 }  // ç§‹å†¬
  }
}
```

**å­£èŠ‚å¯¹åº”è¡¨**ï¼š

| æœˆä»½ | å­£èŠ‚ | é£Ÿç‰©ç³»æ•° |
|------|------|---------|
| 0, 1 | å†¬å­£ | 0.8 |
| 2-7 | æ˜¥å¤ | 1.2 |
| 8-11 | ç§‹å†¬ | 0.8 |

#### 3.2.6 æ”¿ç­–å½±å“

```typescript
// é£Ÿç‰©æ”¿ç­–
é£Ÿç‰©åŠ æˆ = Î£(floor(è°ƒæ•´åé£Ÿç‰©äº§å‡º Ã— policy.foodProduction))

// èµ„é‡‘æ”¿ç­–
èµ„é‡‘åŠ æˆ = Î£(floor(100 Ã— policy.economy))

// æœ€ç»ˆèµ„æº
newFood = æ—§é£Ÿç‰© + äº§å‡º + é£Ÿç‰©åŠ æˆ - æ¶ˆè€—
newMoney = æ—§èµ„é‡‘ + æ”¶å…¥ + èµ„é‡‘åŠ æˆ - æ”¯å‡º
```

**æ”¿ç­–ç¤ºä¾‹**ï¼š

```
æ”¿ç­–: "é¼“åŠ±å†œä¸š"
effects: { foodProduction: 0.1 }  // +10%é£Ÿç‰©äº§å‡º

é£Ÿç‰©äº§å‡º265 â†’ åŠ æˆ = floor(265 Ã— 0.1) = 26
æœ€ç»ˆäº§å‡º = 265 + 26 = 291
```

#### 3.2.7 çŸ­ç¼ºæ•ˆæœ

```typescript
if (newFood < 0) {
  // é£Ÿç‰©çŸ­ç¼ºï¼šå…¨å‘˜å¥åº·-2
  livingPeople.forEach(person => {
    updatePerson(person.id, {
      health: Math.max(0, person.health - 2)
    })
  })
}

if (newMoney < 0) {
  // èµ„é‡‘çŸ­ç¼ºï¼šå¢åŠ è´Ÿèµ„äº§æœˆä»½è®¡æ•°
  negativeMoneyMonths++
}
```

### 3.3 ç»Ÿè®¡ç³»ç»Ÿ

#### 3.3.1 å®æ—¶ç»Ÿè®¡

```typescript
// æ¯æœˆæ›´æ–°
averageAge = Î£(å­˜æ´»äººå£å¹´é¾„) / å­˜æ´»äººå£æ•°
averageHealth = Î£(å­˜æ´»äººå£å¥åº·) / å­˜æ´»äººå£æ•°
averageEducation = Î£(å­˜æ´»äººå£æ•™è‚²) / å­˜æ´»äººå£æ•°
```

#### 3.3.2 å¹´åº¦ç»Ÿè®¡

```typescript
if (æœˆä»½ === 0 && å¹´ä»½ > 0) {
  // è®°å½•å¹´åº¦äººå£
  statistics.populationHistory.push({
    year: currentYear,
    count: populationCount
  })

  // è®°å½•å¹´åº¦èµ„æº
  statistics.resourceHistory.push({
    year: currentYear,
    resources: currentResources
  })
}
```

---

## 4. ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### 4.1 ä¼˜å…ˆçº§åˆ†ç±»

#### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒä½“éªŒï¼‰

**1. æ•°å€¼å¹³è¡¡è°ƒæ•´**
- [ ] è°ƒæ•´åŸºç¡€ç”Ÿè‚²ç‡ï¼ˆå½“å‰5%å¯èƒ½åä½ï¼‰
- [ ] è°ƒæ•´é£Ÿç‰©/èµ„é‡‘äº§å‡ºæ¶ˆè€—æ¯”ä¾‹
- [ ] ä¼˜åŒ–å¹´é¾„åˆ†å¸ƒï¼ˆåˆå§‹äººå£18-50å²åå¹´è½»ï¼‰
- [ ] å¹³è¡¡å­£èŠ‚ä¿®æ­£ï¼ˆÂ±20%å¯èƒ½å¤ªæç«¯ï¼‰

**2. æ¸¸æˆèŠ‚å¥ä¼˜åŒ–**
- [ ] æ·»åŠ æ¸¸æˆé€Ÿåº¦é¢„è®¾ï¼ˆå½“å‰5æ¡£å·²å¤Ÿç”¨ï¼‰
- [ ] æ·»åŠ æš‚åœåŠŸèƒ½ï¼ˆå½“å‰å·²å®ç°ï¼‰
- [ ] æ·»åŠ å¿«é€Ÿå­˜æ¡£/è¯»æ¡£
- [ ] æ·»åŠ è‡ªåŠ¨å­˜æ¡£ï¼ˆæ¯12ä¸ªæœˆï¼‰

**3. UI/UXæ”¹è¿›**
- [ ] æ·»åŠ åŠ è½½ç•Œé¢
- [ ] æ·»åŠ æš‚åœè¦†ç›–å±‚
- [ ] ä¼˜åŒ–Canvasæ¸²æŸ“æ€§èƒ½ï¼ˆå½“å‰å¯èƒ½å¡é¡¿ï¼‰
- [ ] æ·»åŠ äººå£è¯¦æƒ…æ‚¬æµ®æç¤º

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰

**4. æ–°å¢æ¸¸æˆç³»ç»Ÿ**
- [ ] ç¾éš¾äº‹ä»¶ç³»ç»Ÿï¼ˆç˜Ÿç–«ã€å¹²æ—±ã€æˆ˜äº‰ï¼‰
- [ ] æŠ€æœ¯ç ”ç©¶ç³»ç»Ÿ
- [ ] å»ºç­‘ç³»ç»Ÿï¼ˆæˆ¿å±‹ã€åŒ»é™¢ã€å­¦æ ¡ï¼‰
- [ ] è´¸æ˜“ç³»ç»Ÿï¼ˆä¸å…¶ä»–éƒ¨è½äº¤æ˜“ï¼‰

**5. æ”¿ç­–æ‰©å±•**
- [ ] æ·»åŠ æ›´å¤šæ”¿ç­–ï¼ˆå½“å‰15é¡¹ï¼‰
- [ ] æ·»åŠ æ”¿ç­–ç»„åˆæ•ˆæœ
- [ ] æ·»åŠ æ”¿ç­–å†²çªæ£€æµ‹
- [ ] æ·»åŠ æ”¿ç­–æ ‘/å‰ç½®æ¡ä»¶

**6. ç»Ÿè®¡ä¸æˆå°±**
- [ ] æ·»åŠ æ›´å¤šå›¾è¡¨ï¼ˆäººå£é‡‘å­—å¡”ã€èµ„æºè¶‹åŠ¿ï¼‰
- [ ] æ·»åŠ æ¯”è¾ƒåŠŸèƒ½ï¼ˆä¸åŒå¹´ä»½å¯¹æ¯”ï¼‰
- [ ] æ·»åŠ æ›´å¤šæˆå°±ï¼ˆå½“å‰å·²æœ‰æ¡†æ¶ï¼‰
- [ ] æ·»åŠ é‡Œç¨‹ç¢‘ç³»ç»Ÿ

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–ä¸é‡æ„ï¼‰

**7. ECSæ¶æ„å®Œå…¨é›†æˆ**
- [ ] å®ç°ECSâ†”Storeæ•°æ®åŒæ­¥
- [ ] æ¿€æ´»æ‰€æœ‰ECS Systems
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‰¹é‡æ›´æ–°ã€æŸ¥è¯¢ç¼“å­˜ï¼‰
- [ ] é€æ­¥è¿ç§»åˆ°å®Œå…¨ECSæ¶æ„

**8. æ€§èƒ½ä¼˜åŒ–**
- [ ] Canvasè™šæ‹ŸåŒ–æ¸²æŸ“ï¼ˆåªæ¸²æŸ“è§†å£å†…ï¼‰
- [ ] äººå£æ•°æ®åˆ†é¡µåŠ è½½
- [ ] è®¡ç®—ç»“æœç¼“å­˜
- [ ] WebWorkerå¼‚æ­¥è®¡ç®—

**9. ä»£ç è´¨é‡**
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] æ·»åŠ é›†æˆæµ‹è¯•
- [ ] å®Œå–„ç±»å‹å®šä¹‰
- [ ] æ·»åŠ JSDocæ³¨é‡Š

**10. å¤šç«¯é€‚é…**
- [ ] ç§»åŠ¨ç«¯é€‚é…ï¼ˆè§¦æ‘¸æ§åˆ¶ï¼‰
- [ ] å“åº”å¼å¸ƒå±€
- [ ] PWAæ”¯æŒ
- [ ] ç¦»çº¿æ¨¡å¼

### 4.2 å¼€å‘è·¯çº¿å›¾

#### ç¬¬ä¸€é˜¶æ®µï¼šç¨³å®šå½“å‰ç‰ˆæœ¬ï¼ˆ1-2å‘¨ï¼‰

```
Week 1:
- [ ] æ•°å€¼å¹³è¡¡è°ƒæ•´
- [ ] UI/UXä¼˜åŒ–
- [ ] Bugä¿®å¤

Week 2:
- [ ] æ·»åŠ å­˜æ¡£ç³»ç»Ÿ
- [ ] æ·»åŠ æ›´å¤šæˆå°±
- [ ] æ€§èƒ½ä¼˜åŒ–
```

#### ç¬¬äºŒé˜¶æ®µï¼šå†…å®¹æ‰©å±•ï¼ˆ3-4å‘¨ï¼‰

```
Week 3-4:
- [ ] ç¾éš¾äº‹ä»¶ç³»ç»Ÿ
- [ ] æ”¿ç­–æ‰©å±•
- [ ] å»ºç­‘ç³»ç»Ÿ

Week 5-6:
- [ ] æŠ€æœ¯ç ”ç©¶ç³»ç»Ÿ
- [ ] è´¸æ˜“ç³»ç»Ÿ
- [ ] å¤šç»“å±€ç³»ç»Ÿ
```

#### ç¬¬ä¸‰é˜¶æ®µï¼šæ¶æ„ä¼˜åŒ–ï¼ˆ2-3å‘¨ï¼‰

```
Week 7-8:
- [ ] ECSæ¶æ„é›†æˆ
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ä»£ç é‡æ„

Week 9:
- [ ] æµ‹è¯•è¦†ç›–
- [ ] æ–‡æ¡£å®Œå–„
- [ ] å‘å¸ƒå‡†å¤‡
```

### 4.3 æŠ€æœ¯å€ºåŠ¡

**å½“å‰å·²çŸ¥é—®é¢˜**ï¼š

1. **ECSæ¶æ„æœªæ¿€æ´»**
   - å½±å“ï¼šä»£ç å†—ä½™ï¼Œæ€§èƒ½æœªä¼˜åŒ–
   - ä¼˜å…ˆçº§ï¼šä¸­
   - é¢„è®¡å·¥æ—¶ï¼š2-3å‘¨

2. **æ— å­˜æ¡£ç³»ç»Ÿ**
   - å½±å“ï¼šæ¸¸æˆæ— æ³•ä¿å­˜è¿›åº¦
   - ä¼˜å…ˆçº§ï¼šé«˜
   - é¢„è®¡å·¥æ—¶ï¼š3-5å¤©

3. **æ•°å€¼æœªå¹³è¡¡**
   - å½±å“ï¼šæ¸¸æˆä½“éªŒä¸ç†æƒ³
   - ä¼˜å…ˆçº§ï¼šé«˜
   - é¢„è®¡å·¥æ—¶ï¼š1å‘¨

4. **Canvasæ€§èƒ½æœªä¼˜åŒ–**
   - å½±å“ï¼šäººå£å¢å¤šæ—¶å¯èƒ½å¡é¡¿
   - ä¼˜å…ˆçº§ï¼šä¸­
   - é¢„è®¡å·¥æ—¶ï¼š1å‘¨

5. **æµ‹è¯•è¦†ç›–ä¸è¶³**
   - å½±å“ï¼šå®¹æ˜“å¼•å…¥æ–°bug
   - ä¼˜å…ˆçº§ï¼šä½
   - é¢„è®¡å·¥æ—¶ï¼š2-3å‘¨

### 4.4 å¿«é€Ÿå¯åŠ¨æŒ‡å—

#### æ·»åŠ æ–°åŠŸèƒ½æ­¥éª¤

1. **å®šä¹‰æ•°æ®ç»“æ„**ï¼ˆtypes.tsï¼‰
2. **æ·»åŠ å¸¸é‡é…ç½®**ï¼ˆconstants/game.tsï¼‰
3. **å®ç°GameEngineé€»è¾‘**ï¼ˆengine/GameEngine.tsï¼‰
4. **æ›´æ–°gameStore**ï¼ˆstore/gameStore.tsï¼‰
5. **åˆ›å»ºUIç»„ä»¶**ï¼ˆcomponents/ï¼‰
6. **Containeræ¨¡å¼é›†æˆ**ï¼ˆContainer.tsxï¼‰

#### ç¤ºä¾‹ï¼šæ·»åŠ æ–°æ”¿ç­–

```typescript
// 1. å®šä¹‰æ”¿ç­–ï¼ˆconstants/policies.tsï¼‰
const NEW_POLICY: Policy = {
  id: 'new-policy',
  name: 'æ–°æ”¿ç­–',
  description: 'æ”¿ç­–æè¿°',
  cost: 100,
  effects: {
    fertilityRate: 0.1,  // ç”Ÿè‚²ç‡+10%
  },
  duration: 12,  // æŒç»­12ä¸ªæœˆ
}

// 2. GameEngineä¸­åº”ç”¨æ•ˆæœï¼ˆprocessPopulationï¼‰
fertilityModifier += policy.effects.fertilityRate

// 3. UIä¼šè‡ªåŠ¨æ˜¾ç¤ºï¼ˆPolicyPanelContainerï¼‰
```

---

## é™„å½•

### A. æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | è¡Œæ•° | èŒè´£ |
|------|------|------|
| `GameEngine.ts` | ~450 | æ¸¸æˆå¼•æ“ |
| `gameStore.ts` | ~420 | çŠ¶æ€ç®¡ç† |
| `PersonComponents.ts` | ~150 | ECSç»„ä»¶å®šä¹‰ |
| `PopulationSystem.ts` | ~360 | ECSäººå£ç³»ç»Ÿ |
| `ResourceSystem.ts` | ~440 | ECSèµ„æºç³»ç»Ÿ |

### B. å¸¸é‡æ±‡æ€»

```typescript
// äººå£å¸¸é‡
INITIAL_POPULATION = 50
INITIAL_AGE_MIN = 18
INITIAL_AGE_MAX = 50

BASE_FERTILITY_RATE = 0.05  // 5%
BASE_DEATH_RATE = 0.001    // 0.1%

MAX_CHILDREN_PER_FAMILY = 5
MIN_AGE_FOR_CHILDBEARING = 18
MAX_AGE_FOR_CHILDBEARING = 45

// èµ„æºå¸¸é‡
INITIAL_FOOD = 200
INITIAL_MONEY = 1000

FOOD_PER_PERSON = 1
FOOD_PER_FARMER = 5  // ECSä¸­ä¸º8

// æ¸¸æˆé€Ÿåº¦
SPEED_MULTIPLIERS = {
  paused: 0,
  '1x': 1,
  '2x': 2,
  '5x': 5,
  '10x': 10
}
```

### C. Gitæäº¤å†å²

```
9dc03df refactor: æ¸…é™¤è°ƒè¯•æ—¥å¿—
58b9aeb fix: æ·»åŠ å‡ºç”Ÿ/æ­»äº¡ç»Ÿè®¡å’Œäº‹ä»¶è®°å½•
4ca3ee2 fix: ä¿®å¤Containerç»„ä»¶æ•°æ®æº
ee78d80 fix: ä¿®å¤populationCountç»Ÿè®¡
c641d17 fix: ä¿®å¤äººå£ç³»ç»Ÿæ ¸å¿ƒé—®é¢˜
d2c5171 fix: ECSç³»ç»Ÿbugå’Œèµ„æºè®¡ç®—
d70c6a9 feat: é‡æ„GameEngineä½¿ç”¨ECS
43797f3 feat: ç»„ä»¶é‡æ„Containeræ¨¡å¼
fd17c39 feat: Storeå±‚å’ŒSelectorå±‚
ab53897 feat: æ”¿ç­–ç»Ÿè®¡æˆå°±ç³»ç»Ÿ
e24ff56 feat: èµ„æºç³»ç»Ÿ
0183699 feat: äººå£ç³»ç»Ÿ
12845bc feat: ECSæ ¸å¿ƒæ¡†æ¶
97d6b0b feat: åˆå§‹å¯ç©ç‰ˆæœ¬
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-12-23
**ç»´æŠ¤è€…**: Claude AI
